{"version":3,"file":"index.vue_vue&type=script&lang.mjs","sources":["../../../../../../packages/components/rate/src/index.vue"],"sourcesContent":["<template>\n  <div\n    class=\"el-rate\"\n    role=\"slider\"\n    :aria-valuenow=\"currentValue\"\n    :aria-valuetext=\"text\"\n    aria-valuemin=\"0\"\n    :aria-valuemax=\"max\"\n    tabindex=\"0\"\n    @keydown=\"handleKey\"\n  >\n    <span\n      v-for=\"(item, key) in max\"\n      :key=\"key\"\n      class=\"el-rate__item\"\n      :style=\"{ cursor: rateDisabled ? 'auto' : 'pointer' }\"\n      @mousemove=\"setCurrentValue(item, $event)\"\n      @mouseleave=\"resetCurrentValue\"\n      @click=\"selectValue(item)\"\n    >\n      <el-icon\n        :class=\"[{ hover: hoverIndex === item }]\"\n        class=\"el-rate__icon\"\n        :style=\"getIconStyle(item)\"\n      >\n        <component :is=\"iconComponents[item - 1]\" />\n        <el-icon\n          v-if=\"showDecimalIcon(item)\"\n          :style=\"decimalStyle\"\n          class=\"el-rate__icon el-rate__decimal\"\n        >\n          <component :is=\"decimalIconComponent\" />\n        </el-icon>\n      </el-icon>\n    </span>\n    <span\n      v-if=\"showText || showScore\"\n      class=\"el-rate__text\"\n      :style=\"{ color: textColor }\"\n      >{{ text }}</span\n    >\n  </div>\n</template>\n<script lang=\"ts\">\nimport { defineComponent, inject, computed, ref, watch } from 'vue'\nimport { isObject, isArray } from '@vue/shared'\nimport { elFormKey } from '@element-plus/tokens'\nimport { hasClass } from '@element-plus/utils/dom'\nimport { EVENT_CODE } from '@element-plus/utils/aria'\n\nimport { UPDATE_MODEL_EVENT } from '@element-plus/utils/constants'\nimport { ElIcon } from '@element-plus/components/icon'\nimport { StarFilled, Star } from '@element-plus/icons'\nimport type { PropType, Component } from 'vue'\nimport type { ElFormContext } from '@element-plus/tokens'\n\nexport default defineComponent({\n  name: 'ElRate',\n  components: { ElIcon, StarFilled, Star },\n  props: {\n    modelValue: {\n      type: Number,\n      default: 0,\n    },\n    lowThreshold: {\n      type: Number,\n      default: 2,\n    },\n    highThreshold: {\n      type: Number,\n      default: 4,\n    },\n    max: {\n      type: Number,\n      default: 5,\n    },\n    colors: {\n      type: [Array, Object],\n      default: () => ['#F7BA2A', '#F7BA2A', '#F7BA2A'],\n    },\n    voidColor: {\n      type: String,\n      default: '#C6D1DE',\n    },\n    disabledVoidColor: {\n      type: String,\n      default: '#EFF2F7',\n    },\n    icons: {\n      type: [Array, Object] as PropType<string[] | Component>,\n      default: () => [StarFilled, StarFilled, StarFilled],\n    },\n    voidIcon: {\n      type: [String, Object] as PropType<string | Component>,\n      default: Star,\n    },\n    disabledvoidIcon: {\n      type: [String, Object] as PropType<string | Component>,\n      default: StarFilled,\n    },\n    disabled: {\n      type: Boolean,\n      default: false,\n    },\n    allowHalf: {\n      type: Boolean,\n      default: false,\n    },\n    showText: {\n      type: Boolean,\n      default: false,\n    },\n    showScore: {\n      type: Boolean,\n      default: false,\n    },\n    textColor: {\n      type: String,\n      default: '#1f2d3d',\n    },\n    texts: {\n      type: Array as PropType<string[]>,\n      default: () => [\n        'Extremely bad',\n        'Disappointed',\n        'Fair',\n        'Satisfied',\n        'Surprise',\n      ],\n    },\n    scoreTemplate: {\n      type: String,\n      default: '{value}',\n    },\n  },\n  emits: [UPDATE_MODEL_EVENT, 'change'],\n  setup(props, { emit }) {\n    const elForm = inject(elFormKey, {} as ElFormContext)\n\n    const currentValue = ref(props.modelValue)\n\n    const rateDisabled = computed(() => props.disabled || elForm.disabled)\n\n    const text = computed(() => {\n      let result = ''\n      if (props.showScore) {\n        result = props.scoreTemplate.replace(\n          /\\{\\s*value\\s*\\}/,\n          rateDisabled.value ? `${props.modelValue}` : `${currentValue.value}`\n        )\n      } else if (props.showText) {\n        result = props.texts[Math.ceil(currentValue.value) - 1]\n      }\n      return result\n    })\n\n    function getValueFromMap(value: unknown, map: Record<string, unknown>) {\n      const matchedKeys = Object.keys(map)\n        .filter((key) => {\n          const val = map[key]\n          const excluded = isObject(val) ? val.excluded : false\n          return excluded ? value < key : value <= key\n        })\n        .sort((a: never, b: never) => a - b)\n      const matchedValue = map[matchedKeys[0]]\n      return isObject(matchedValue)\n        ? matchedValue.value || matchedValue\n        : matchedValue || ''\n    }\n\n    const valueDecimal = computed(\n      () => props.modelValue * 100 - Math.floor(props.modelValue) * 100\n    )\n    const colorMap = computed(() =>\n      isArray(props.colors)\n        ? {\n            [props.lowThreshold]: props.colors[0],\n            [props.highThreshold]: { value: props.colors[1], excluded: true },\n            [props.max]: props.colors[2],\n          }\n        : props.colors\n    )\n    const activeColor = computed(() =>\n      getValueFromMap(currentValue.value, colorMap.value)\n    )\n    const decimalStyle = computed(() => {\n      let width = ''\n      if (rateDisabled.value) {\n        width = `${valueDecimal.value}%`\n      } else if (props.allowHalf) {\n        width = '50%'\n      }\n      return {\n        color: activeColor.value,\n        width,\n      }\n    })\n\n    const componentMap = computed(() =>\n      isArray(props.icons)\n        ? {\n            [props.lowThreshold]: props.icons[0],\n            [props.highThreshold]: {\n              value: props.icons[1],\n              excluded: true,\n            },\n            [props.max]: props.icons[2],\n          }\n        : props.icons\n    )\n\n    const decimalIconComponent = computed(() =>\n      getValueFromMap(props.modelValue, componentMap.value)\n    )\n    const voidComponent = computed(() =>\n      rateDisabled.value ? props.disabledvoidIcon : props.voidIcon\n    )\n    const activeComponent = computed(() =>\n      getValueFromMap(currentValue.value, componentMap.value)\n    )\n    const iconComponents = computed(() => {\n      const result = Array(props.max)\n      const threshold = currentValue.value\n      // if (props.allowHalf && currentValue.value !== Math.floor(currentValue.value)) {\n      //   threshold--\n      // }\n      result.fill(activeComponent.value, 0, threshold)\n      result.fill(voidComponent.value, threshold, props.max)\n      return result\n    })\n\n    const pointerAtLeftHalf = ref(true)\n    watch(\n      () => props.modelValue,\n      (val) => {\n        currentValue.value = val\n        pointerAtLeftHalf.value =\n          props.modelValue !== Math.floor(props.modelValue)\n      }\n    )\n\n    function showDecimalIcon(item: number) {\n      const showWhenDisabled =\n        rateDisabled.value &&\n        valueDecimal.value > 0 &&\n        item - 1 < props.modelValue &&\n        item > props.modelValue\n      /* istanbul ignore next */\n      const showWhenAllowHalf =\n        props.allowHalf &&\n        pointerAtLeftHalf.value &&\n        item - 0.5 <= currentValue.value &&\n        item > currentValue.value\n      return showWhenDisabled || showWhenAllowHalf\n    }\n\n    function getIconStyle(item: number) {\n      const voidColor = rateDisabled.value\n        ? props.disabledVoidColor\n        : props.voidColor\n      return {\n        color: item <= currentValue.value ? activeColor.value : voidColor,\n      }\n    }\n\n    function selectValue(value: number) {\n      if (rateDisabled.value) {\n        return\n      }\n      if (props.allowHalf && pointerAtLeftHalf.value) {\n        emit(UPDATE_MODEL_EVENT, currentValue.value)\n        if (props.modelValue !== currentValue.value) {\n          emit('change', currentValue.value)\n        }\n      } else {\n        emit(UPDATE_MODEL_EVENT, value)\n        if (props.modelValue !== value) {\n          emit('change', value)\n        }\n      }\n    }\n\n    function handleKey(e: KeyboardEvent) {\n      if (rateDisabled.value) {\n        return\n      }\n      let _currentValue = currentValue.value\n      const code = e.code\n      if (code === EVENT_CODE.up || code === EVENT_CODE.right) {\n        if (props.allowHalf) {\n          _currentValue += 0.5\n        } else {\n          _currentValue += 1\n        }\n        e.stopPropagation()\n        e.preventDefault()\n      } else if (code === EVENT_CODE.left || code === EVENT_CODE.down) {\n        if (props.allowHalf) {\n          _currentValue -= 0.5\n        } else {\n          _currentValue -= 1\n        }\n        e.stopPropagation()\n        e.preventDefault()\n      }\n      _currentValue = _currentValue < 0 ? 0 : _currentValue\n      _currentValue = _currentValue > props.max ? props.max : _currentValue\n      emit(UPDATE_MODEL_EVENT, _currentValue)\n      emit('change', _currentValue)\n      return _currentValue\n    }\n\n    const hoverIndex = ref(-1)\n\n    function setCurrentValue(value: number, event: MouseEvent) {\n      if (rateDisabled.value) {\n        return\n      }\n      /* istanbul ignore if */\n      if (props.allowHalf) {\n        let target = event.target as HTMLElement\n        if (hasClass(target, 'el-rate__item')) {\n          target = target.querySelector('.el-rate__icon')\n        }\n        if (target.clientWidth === 0 || hasClass(target, 'el-rate__decimal')) {\n          target = target.parentNode as HTMLElement\n        }\n        pointerAtLeftHalf.value = event.offsetX * 2 <= target.clientWidth\n        currentValue.value = pointerAtLeftHalf.value ? value - 0.5 : value\n      } else {\n        currentValue.value = value\n      }\n      hoverIndex.value = value\n    }\n\n    function resetCurrentValue() {\n      if (rateDisabled.value) {\n        return\n      }\n      if (props.allowHalf) {\n        pointerAtLeftHalf.value =\n          props.modelValue !== Math.floor(props.modelValue)\n      }\n      currentValue.value = props.modelValue\n      hoverIndex.value = -1\n    }\n\n    if (!props.modelValue) {\n      emit(UPDATE_MODEL_EVENT, 0)\n    }\n    return {\n      hoverIndex,\n\n      currentValue,\n      rateDisabled,\n      text,\n      decimalStyle,\n      decimalIconComponent,\n      iconComponents,\n\n      showDecimalIcon,\n      getIconStyle,\n      selectValue,\n      handleKey,\n      setCurrentValue,\n      resetCurrentValue,\n    }\n  },\n})\n</script>\n"],"names":[],"mappings":"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"}